# Define el nombre del flujo de trabajo
name: CD / Deployment to Kubernetes

# Se dispara despu√©s de un push exitoso a 'main'
on:
  push:
    branches:
      - main
      - dev # üí° Ahora se dispara tambi√©n con push a la rama 'dev'
      
# El job principal para el despliegue
jobs:
  deploy:
    runs-on: ubuntu-latest
    
    # Define un entorno de despliegue (opcional pero buena pr√°ctica)
    environment: production 
    
    steps:
      - name: Checkout Code
        
        uses: actions/checkout@v4
      - name: Set up Kubeconfig Context
        uses: azure/k8s-set-context@v4
        with:
          method: kubeconfig
          kubeconfig: ${{ secrets.KUBE_CONFIG_DATA }}
          
      - name: Deploy Kubernetes Manifests
        
        uses: azure/k8s-deploy@v4
        with:
        
          manifests: |
            kubernetes/app-config.yaml
            kubernetes/app-secret.yaml
            kubernetes/app-pv-pvc.yaml
            kubernetes/app-deployment.yaml
            kubernetes/app-service.yaml
          namespace: default 
          action: deploy 
          
      - name: Verify Deployment Status
  
        run: kubectl rollout status deployment/devops-app-deployment
